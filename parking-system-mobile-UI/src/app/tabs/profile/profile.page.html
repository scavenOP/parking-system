<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/tab1"></ion-back-button>
    </ion-buttons>
    <ion-title>Profile</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleEdit()" *ngIf="!isEditing">
        <ion-icon name="create" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Profile Header -->
  <div class="profile-header" *ngIf="user">
    <div class="avatar">
      <div class="avatar-circle">
        <span class="initials">{{getInitials(user.Name)}}</span>
      </div>
    </div>
    
    <div class="user-info">
      <h2 *ngIf="!isEditing">{{user.Name}}</h2>
      <p class="email" *ngIf="!isEditing">{{user.Email}}</p>
      <ion-chip color="primary" *ngIf="user.Role">
        <ion-label>{{user.Role}}</ion-label>
      </ion-chip>
    </div>
  </div>

  <!-- Edit Form -->
  <ion-card *ngIf="isEditing" class="edit-form">
    <ion-card-header>
      <ion-card-title>Edit Profile</ion-card-title>
    </ion-card-header>
    
    <ion-card-content>
      <ion-item>
        <ion-label position="stacked">Full Name *</ion-label>
        <ion-input 
          [(ngModel)]="editableUser.name" 
          placeholder="Enter your full name"
          required>
        </ion-input>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">Email *</ion-label>
        <ion-input 
          type="email"
          [(ngModel)]="editableUser.email" 
          placeholder="Enter your email"
          required>
        </ion-input>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">Address</ion-label>
        <ion-textarea 
          [(ngModel)]="editableUser.address" 
          placeholder="Enter your address"
          rows="2">
        </ion-textarea>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">Date of Birth</ion-label>
        <ion-datetime 
          [(ngModel)]="editableUser.dateOfBirth"
          presentation="date"
          max="2010-12-31">
        </ion-datetime>
      </ion-item>
      
      <div class="form-buttons">
        <ion-button 
          expand="block" 
          (click)="saveProfile()" 
          [disabled]="!isFormValid()">
          <ion-icon name="checkmark" slot="start"></ion-icon>
          Save Changes
        </ion-button>
        
        <ion-button 
          expand="block" 
          fill="outline" 
          (click)="toggleEdit()">
          <ion-icon name="close" slot="start"></ion-icon>
          Cancel
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Profile Details -->
  <ion-card *ngIf="!isEditing && user" class="profile-details">
    <ion-card-header>
      <ion-card-title>Personal Information</ion-card-title>
    </ion-card-header>
    
    <ion-card-content>
      <div class="detail-item">
        <ion-icon name="person" color="primary"></ion-icon>
        <div class="detail-content">
          <p class="label">Full Name</p>
          <p class="value">{{user.Name}}</p>
        </div>
      </div>
      
      <div class="detail-item">
        <ion-icon name="mail" color="primary"></ion-icon>
        <div class="detail-content">
          <p class="label">Email</p>
          <p class="value">{{user.Email}}</p>
        </div>
      </div>
      
      <div class="detail-item">
        <ion-icon name="location" color="primary"></ion-icon>
        <div class="detail-content">
          <p class="label">Address</p>
          <p class="value">{{user.Address || 'Not provided'}}</p>
        </div>
      </div>
      
      <div class="detail-item">
        <ion-icon name="calendar" color="primary"></ion-icon>
        <div class="detail-content">
          <p class="label">Date of Birth</p>
          <p class="value">{{formatDate(user.DateOfBirth)}}</p>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Statistics -->
  <ion-card *ngIf="!isEditing" class="stats-card">
    <ion-card-header>
      <ion-card-title>Parking Statistics</ion-card-title>
    </ion-card-header>
    
    <ion-card-content>
      <div class="stats-grid">
        <div class="stat-item">
          <ion-icon name="car" color="primary"></ion-icon>
          <div class="stat-content">
            <p class="stat-value">{{stats.totalBookings}}</p>
            <p class="stat-label">Total Bookings</p>
          </div>
        </div>
        
        <div class="stat-item">
          <ion-icon name="cash" color="success"></ion-icon>
          <div class="stat-content">
            <p class="stat-value">${{stats.totalSpent}}</p>
            <p class="stat-label">Total Spent</p>
          </div>
        </div>
        
        <div class="stat-item">
          <ion-icon name="time" color="warning"></ion-icon>
          <div class="stat-content">
            <p class="stat-value">{{stats.totalHours}}h</p>
            <p class="stat-label">Total Hours</p>
          </div>
        </div>
        
        <div class="stat-item">
          <ion-icon name="star" color="tertiary"></ion-icon>
          <div class="stat-content">
            <p class="stat-value">{{stats.favoriteSpot}}</p>
            <p class="stat-label">Favorite Spot</p>
          </div>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Settings -->
  <ion-card *ngIf="!isEditing" class="settings-card">
    <ion-card-header>
      <ion-card-title>Account Settings</ion-card-title>
    </ion-card-header>
    
    <ion-card-content>
      <ion-item button (click)="changePassword()">
        <ion-icon name="key" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Change Password</h3>
          <p>Update your account password</p>
        </ion-label>
        <ion-icon name="chevron-forward" slot="end"></ion-icon>
      </ion-item>
      
      <ion-item button>
        <ion-icon name="notifications" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Notifications</h3>
          <p>Manage notification preferences</p>
        </ion-label>
        <ion-toggle slot="end" checked></ion-toggle>
      </ion-item>
      
      <ion-item button>
        <ion-icon name="shield-checkmark" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Privacy Settings</h3>
          <p>Control your privacy preferences</p>
        </ion-label>
        <ion-icon name="chevron-forward" slot="end"></ion-icon>
      </ion-item>
    </ion-card-content>
  </ion-card>

  <!-- Actions -->
  <ion-card *ngIf="!isEditing" class="actions-card">
    <ion-card-content>
      <ion-button 
        expand="block" 
        fill="outline" 
        (click)="logout()">
        <ion-icon name="log-out" slot="start"></ion-icon>
        Logout
      </ion-button>
      
      <ion-button 
        expand="block" 
        color="danger" 
        fill="outline" 
        (click)="deleteAccount()">
        <ion-icon name="trash" slot="start"></ion-icon>
        Delete Account
      </ion-button>
    </ion-card-content>
  </ion-card>
</ion-content>